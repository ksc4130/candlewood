function config(e,t,n,r){r.interceptors.push("authInterceptor"),t.otherwise("/login"),e.state("login",{url:"/login",templateUrl:"/app/views/_login.html",controller:"loginCtrl",resolve:{tab:[function(){return 1}]}}).state("documents",{url:"/members/documents",templateUrl:"/app/views/_documents.html",controller:"documentsCtrl",resolve:{docs:["documentSrv",function(e){return e.getDocuments()}]}}).state("admin",{url:"/admin",templateUrl:"/app/views/_admin.html",controller:"adminCtrl",resolve:{docs:["documentSrv",function(e){return e.getDocuments()}]}}),n.html5Mode(!0)}var app=angular.module("cwl.core",["ui.router","ui.bootstrap","ngAside","angularFileUpload","ngCookies"]);app.run(["$rootScope",function(e){e.today=new Date}]),app.config(config),config.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider"],function(){"use strict";function e(e,n,r,o){function s(){const r=n.defer();return e.get("/account/user").then(function(e){if(200===e.status&&e.data)return t=e.data,r.resolve(e);l(),r.resolve()}),r.promise}function u(){const t=n.defer();return e.get("/user").then(function(e){200===e.status?t.resolve(e.data):t.reject(e)},function(e){t.reject(e)}),t.promise}function i(t){const r=n.defer();return e.put("/user",t).then(function(e){200===e.status?r.resolve(e.data):r.reject(e)},function(e){r.reject(e)}),r.promise}function c(t){const r=n.defer();return e.delete("/user/"+t.id).then(function(e){200===e.status?r.resolve(e):r.reject(e)},function(e){r.reject(e)}),r.promise}function l(){console.log("logout"),o.remove("t"),t=null}function a(s){var u=n.defer();return e.post("/account/login",s).then(function(e){200===e.status?(t=e.data.user,o.put("t",t.token),r.$broadcast("auth"),u.resolve(e.data)):(console.log(e),u.reject(e))},function(e){u.reject(e),console.log(e)}),u.promise}function d(t){var r=n.defer();return e.post("/account/user",{user:t}).then(function(e){200===e.status?r.resolve(e.data.user):(console.log(e),r.reject(e))},function(e){r.reject(e),console.log(e)}),r.promise}return{login:a,register:d,fillCurrentUser:s,logout:l,getUsers:u,updateUser:i,deleteUser:c,user:function(){return t?{firstName:t.firstName,lastName:t.lastName,email:t.email,isAdmin:t.isAdmin,isActive:t.isActive}:null}}}var t=null;angular.module("cwl.core").factory("authSrv",e),e.$inject=["$http","$q","$rootScope","$cookies"],$(function(){var e=document.cookie.replace(/(?:(?:^|.*;\s*)t\s*\=\s*([^;]*).*$)|^.*$/,"$1");$.ajax({url:"/account/user",headers:{"x-session-token":e},success:function(e){t=e,angular.bootstrap($("html")[0],["cwl.core"])},error:function(e){angular.bootstrap($("html")[0],["cwl.core"])}})})}(),function(){"use strict";function e(e,t){function n(){var n=t.defer();return e.get("/doc").then(function(e){200===e.status?n.resolve(e.data):n.reject(e)},function(e){n.reject(e)}),n.promise}function r(n){var r=t.defer();return e.delete("/doc/"+n.id).then(function(e){200===e.status?r.resolve(e):r.reject(e)},function(e){r.reject(e)}),r.promise}return{getDocuments:n,deleteDocument:r}}angular.module("cwl.core").factory("documentSrv",e),e.$inject=["$http","$q"]}(),function(){"use strict";function e(e,t,n,r,o){t.user()||r.path("/login"),e.user=t.user(),e.editUser=null,t.getUsers().then(function(t){t&&t.length&&(e.users=t)}),e.newUser={isAdmin:!1,isActive:!0},e.uploader=new n({formData:[],url:"/upload",queueLimit:1}),e.uploader.onBeforeUploadItem=function(t){t.formData.push(e.newDoc)},e.newDoc={when:new Date},e.types=[{type:"policies",name:"Policies"},{type:"non-permits",name:"Non ERC Permits"},{type:"minutes",name:"Minutes"},{type:"erc-permits",name:"ERC Permits"},{type:"security",name:"Security"},{type:"chronicle",name:"Chronicle"},{type:"other",name:"Other"}],e.prettyDoc=function(t){return t&&e.types.filter(function(e){return e.type===t})[0]?e.types.filter(function(e){return e.type===t})[0].name:null},e.removeDoc=function(t){var n=e.documents.filter(function(e){return e.name===t.name&&e.type===t.type&&t.when===e.when})[0];n&&documentSrv.deleteDocument(t).then(function(t){200===t.status&&e.documents.splice(e.documents.indexOf(n),1)})},e.submit=function(){e.uploader.formData.push(e.newDoc),e.uploader.uploadAll()},e.updateUser=function(){e.editUser.saving=!0,t.updateUser(e.editUser).then(function(t){if(t&&!t.message){var n=e.users.filter(function(e){return e.id===user.id})[0];n&&(e.users[e.users.indexOf(n)]=t),e.editUser=null}else e.editUser.error=!0,console.log("Error",t),e.editUser.saving=!1},function(t){console.log("error",t),e.editUser.error=!0,e.editUser.saving=!1})},e.deleteUser=function(n){n.deleting=!0,t.deleteUser(n).then(function(t){if(200===t.status){var r=e.users.filter(function(e){return e.id===n.id})[0];r&&e.users.splice(e.users.indexOf(r),1)}else console.log("error",t),n.deleting=!1},function(e){console.log("error",e),n.deleting=!1})},e.register=function(){if(e.newUser.firstName&&e.newUser.lastName&&e.newUser.email&&e.newUser.pwd&&e.newUser.passwordConfirm){if(e.newUser.pwd!==e.newUser.passwordConfirm)return void(e.error="Passwords do not match.");t.register(e.newUser).then(function(t){t&&!t.message&&(e.users.push(t),e.newUser={isActive:!0,isAdmin:!1})})}else e.error="Please fill out all fields."}}angular.module("cwl.core").controller("adminCtrl",e),e.$inject=["$scope","authSrv","FileUploader","$location","docs"]}(),function(){"use strict";function e(e,t,n,r){t.user()||n.path("/login"),e.user=t.user(),e.types=[{type:"policies",name:"Policies"},{type:"non-permits",name:"Non ERC Permits"},{type:"minutes",name:"Minutes"},{type:"erc-permits",name:"ERC Permits"},{type:"security",name:"Security"},{type:"chronicle",name:"Chronicle"},{type:"other",name:"Other"}],e.selectedDocument=null,e.select=function(t){e.selectedDocument=angular.copy(t)},e.selected=function(t){return t&&e.selectedDocument&&t.name===e.selectedDocument.name},e.filterDocs={},e.documents=r,console.log(e.documents)}angular.module("cwl.core").controller("documentsCtrl",e),e.$inject=["$scope","authSrv","$location","docs"]}(),function(){"use strict";function e(e){e.user={isAuthenticated:function(){return!0}}}angular.module("cwl.core").controller("homeCtrl",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,n,r){t.user()&&n.path("/members/documents"),e.tab=r||1,e.showPass=!0,e.showConfirm=!0,e.showFirstName=!0,e.showLastName=!0,e.showEmail=!0,e.user={},e.forgot={},e.login=function(){t.login(e.user).then(function(e){e&&!e.message&&n.path("/members/documents")})},e.register=function(){if(e.error=null,e.user.pwd!==e.user.passwordConfirm)return void(e.error="Passwords do not match.");t.register(e.user).then(function(t){t&&!t.message&&(console.log(t),e.registrationSent=!0)})},e.forgotPassword=function(){t.forgotPassword(e.forgot)}}angular.module("cwl.core").controller("loginCtrl",e),e.$inject=["$scope","authSrv","$location","tab"]}(),function(){"use strict";function e(e,t,n,r){e.login=function(e){n.open({backdrop:!0,templateUrl:"/app/views/loginModal.html",controller:"loginCtrl",animation:!0,size:"md",resolve:{tab:[function(){return e}]}})},e.user=t.user(),e.$on("auth",function(){e.user=t.user()}),e.openAside=function(){r.open({templateUrl:"/app/views/menuAside.html",placement:"right",size:"sm",backdrop:!0,controller:["$scope","$uibModalInstance",function(e,t){e.close=function(){t.dismiss()},e.go=function(e){t.close(e)}}]}).result.then(function(t){e.login(t)})}}angular.module("cwl.core").controller("navCtrl",e),e.$inject=["$scope","authSrv","$uibModal","$aside"]}(),function(){"use strict";function e(e){return{request:function(t){const n=e.get("t");return n&&(t.headers["x-session-token"]=n),t}}}angular.module("cwl.core").factory("authInterceptor",e),e.$inject=["$cookies"]}();
//# sourceMappingURL=app.min.js.map