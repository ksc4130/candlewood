function config(e,t,n,o){o.interceptors.push("authInterceptor"),t.otherwise("/login"),e.state("login",{url:"/login",templateUrl:"/app/views/_login.html",controller:"loginCtrl",resolve:{tab:[function(){return 1}]}}).state("documents",{url:"/members/documents",templateUrl:"/app/views/_documents.html",controller:"documentsCtrl",resolve:{docs:["documentSrv",function(e){return e.getDocuments()}]}}).state("admin",{url:"/admin",templateUrl:"/app/views/_admin.html",controller:"adminCtrl",resolve:{docs:["documentSrv",function(e){return e.getDocuments()}]}}),n.html5Mode(!0)}var app=angular.module("cwl.core",["ui.router","ui.bootstrap","ngAside","angularFileUpload","ngCookies"]);app.run(["$rootScope",function(e){e.today=new Date}]),app.config(config),config.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider"],function(){"use strict";function e(e,n,o,r,s){function i(){const o=n.defer();return e.get("/account/user").then(function(e){if(200===e.status&&e.data)return t=e.data,o.resolve(e);a(),o.resolve()}),o.promise}function u(){const t=n.defer();return e.get("/user").then(function(e){200===e.status?t.resolve(e.data):t.reject(e)},function(e){t.reject(e)}),t.promise}function c(t){const o=n.defer();return e.put("/user",{user:t}).then(function(e){200===e.status?o.resolve(e.data):o.reject(e)},function(e){o.reject(e)}),o.promise}function l(t){const o=n.defer();return e.delete("/user/"+t._id).then(function(e){200===e.status?o.resolve(e):o.reject(e)},function(e){o.reject(e)}),o.promise}function a(){console.log("logout"),r.remove("t"),t=null,s.path("/login")}function d(s){var i=n.defer();return e.post("/account/login",s).then(function(e){200===e.status?(t=e.data.user,r.put("t",t.token),o.$broadcast("auth"),i.resolve(e.data)):(console.log(e),i.reject(e))},function(e){i.reject(e),console.log(e)}),i.promise}function f(t){var o=n.defer();return e.post("/account/user",{user:t}).then(function(e){200===e.status?o.resolve(e.data.user):(console.log(e),o.reject(e))},function(e){o.reject(e),console.log(e)}),o.promise}return{login:d,register:f,fillCurrentUser:i,logout:a,getUsers:u,updateUser:c,deleteUser:l,user:function(){return t?{firstName:t.firstName,lastName:t.lastName,email:t.email,isAdmin:t.isAdmin,isActive:t.isActive}:null}}}var t=null;angular.module("cwl.core").factory("authSrv",e),e.$inject=["$http","$q","$rootScope","$cookies","$location"],$(function(){var e=document.cookie.replace(/(?:(?:^|.*;\s*)t\s*\=\s*([^;]*).*$)|^.*$/,"$1");$.ajax({url:"/account/user",headers:{"x-session-token":e},success:function(e){t=e,angular.bootstrap($("html")[0],["cwl.core"])},error:function(e){angular.bootstrap($("html")[0],["cwl.core"])}})})}(),function(){"use strict";function e(e,t){function n(){var n=t.defer();return e.get("/doc").then(function(e){200===e.status?n.resolve(e.data):n.reject(e)},function(e){n.reject(e)}),n.promise}function o(n){var o=t.defer();return e.get("/doc/"+n).then(function(e){200===e.status?o.resolve(e.data):o.reject(e)},function(e){o.reject(e)}),o.promise}function r(n){var o=t.defer();return e.put("/doc/",n).then(function(e){200===e.status?o.resolve(e.data):o.reject(e)},function(e){o.reject(e)}),o.promise}function s(n){var o=t.defer();return e.delete("/doc/"+n._id).then(function(e){200===e.status?o.resolve(e):o.reject(e)},function(e){o.reject(e)}),o.promise}return{getDocuments:n,getDoc:o,updateDoc:r,deleteDocument:s,types:[{type:"policies",name:"Policies"},{type:"non-permits",name:"Non ECC Permits"},{type:"minutes",name:"Minutes"},{type:"ecc-permits",name:"ECC Permits"},{type:"agenda",name:"Agenda"},{type:"other",name:"Other"}]}}angular.module("cwl.core").factory("documentSrv",e),e.$inject=["$http","$q"]}(),function(){"use strict";function e(e,t,n,o,r,s){t.user()||o.path("/login"),e.user=t.user(),e.editUser=null,e.documents=r,t.getUsers().then(function(t){t&&t.length&&(e.users=t)}),e.newUser={isAdmin:!1,isActive:!0},function(){e.uploader=new n({removeAfterUpload:!0,formData:[],url:"/upload",queueLimit:1,onCompleteItem:function(t,n,o,r){200===o?(e.documents.push(n),e.newDoc={when:new Date}):e.uploadError=n}}),e.uploader.onBeforeUploadItem=function(t){t.formData.push(e.newDoc)},e.uploader.onCompleteAll=function(e){document.getElementById("uploader").value=null}}(),e.newDoc={when:new Date},e.filteredDocuments=function(){return e.documents?e.typeFilter?e.documents.filter(function(t){return t.type===e.typeFilter}):e.documents:null},e.types=s.types,e.selectUser=function(t){e.editUser=angular.copy(t)},e.selectDoc=function(t){e.editDoc=angular.copy(t),e.editDoc.when=new Date(e.editDoc.when)},e.updateDoc=function(){e.editDoc.name&&e.editDoc.when&&e.editDoc.type?(e.editDoc.saving=!0,s.updateDoc(e.editDoc).then(function(t){if(t&&!t.message){var n=e.documents.filter(function(t){return t._id===e.editDoc._id})[0];n&&(e.documents[e.documents.indexOf(n)]=t),e.editDoc=null}else e.editDoc.error=t,console.log("error",t)},function(t){e.editDoc.error=t,console.log("error",t)})):e.editDoc.error="Please fill out all required fields."},e.removeDoc=function(t){var n=e.documents.filter(function(e){return e._id===t._id})[0];n&&s.deleteDocument(t).then(function(t){200===t.status&&e.documents.splice(e.documents.indexOf(n),1)})},e.submit=function(){e.uploader.uploadAll()},e.updateUser=function(){e.editUser.saving=!0,t.updateUser(e.editUser).then(function(t){if(t&&!t.message){var n=e.users.filter(function(t){return t._id===e.editUser._id})[0];n&&(e.users[e.users.indexOf(n)]=t),e.editUser=null}else e.editUser.error=!0,console.log("Error",t),e.editUser.saving=!1},function(t){console.log("error",t),e.editUser.error=!0,e.editUser.saving=!1})},e.deleteUser=function(n){n.deleting=!0,t.deleteUser(n).then(function(t){if(200===t.status){var o=e.users.filter(function(e){return e._id===n._id})[0];o&&e.users.splice(e.users.indexOf(o),1)}else console.log("error",t),n.deleting=!1},function(e){console.log("error",e),n.deleting=!1})},e.register=function(){if(e.newUser.firstName&&e.newUser.lastName&&e.newUser.email&&e.newUser.pwd&&e.newUser.passwordConfirm){if(e.newUser.pwd!==e.newUser.passwordConfirm)return void(e.error="Passwords do not match.");t.register(e.newUser).then(function(t){t&&!t.message&&(e.users.push(t),e.newUser={isActive:!0,isAdmin:!1})})}else e.error="Please fill out all fields."}}angular.module("cwl.core").controller("adminCtrl",e),e.$inject=["$scope","authSrv","FileUploader","$location","docs","documentSrv"]}(),function(){"use strict";function e(e,t,n,o,r){t.user()||n.path("/login"),e.user=t.user(),e.types=r.types,e.selectedDocument=null,e.select=function(t){e.selectedDocument=angular.copy(t)},e.selected=function(t){return t&&e.selectedDocument&&t._id===e.selectedDocument._id},e.filterDocs={},e.documents=o,console.log(e.documents)}angular.module("cwl.core").controller("documentsCtrl",e),e.$inject=["$scope","authSrv","$location","docs","documentSrv"]}(),function(){"use strict";function e(e){e.user={isAuthenticated:function(){return!0}}}angular.module("cwl.core").controller("homeCtrl",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,n,o){t.user()&&n.path("/members/documents"),e.tab=o||1,e.showPass=!0,e.showConfirm=!0,e.showFirstName=!0,e.showLastName=!0,e.showEmail=!0,e.user={},e.forgot={},e.login=function(){t.login(e.user).then(function(t){t&&!t.message?n.path("/members/documents"):(e.error="Login Failed.",console.log(t))},function(t){e.error="Login Failed.",console.log(t)})},e.register=function(){if(e.error=null,e.user.pwd!==e.user.passwordConfirm)return void(e.error="Passwords do not match.");t.register(e.user).then(function(t){t&&!t.message?e.registrationSent=!0:(e.error="Registration Failed.",console.log(t))},function(t){console.log(t),e.error="Registration Failed."})},e.forgotPassword=function(){t.forgotPassword(e.forgot)}}angular.module("cwl.core").controller("loginCtrl",e),e.$inject=["$scope","authSrv","$location","tab"]}(),function(){"use strict";function e(e,t,n,o,r){e.login=function(e){n.open({backdrop:!0,templateUrl:"/app/views/loginModal.html",controller:"loginCtrl",animation:!0,size:"md",resolve:{tab:[function(){return e}]}})},e.state=r,e.user=t.user(),e.logout=function(){t.logout(),e.user=null},e.$on("auth",function(){e.user=t.user()}),e.openAside=function(){o.open({templateUrl:"/app/views/menuAside.html",placement:"right",size:"sm",backdrop:!0,controller:["$scope","$uibModalInstance",function(e,t){e.close=function(){t.dismiss()},e.go=function(e){t.close(e)}}]}).result.then(function(t){e.login(t)})}}angular.module("cwl.core").controller("navCtrl",e),e.$inject=["$scope","authSrv","$uibModal","$aside","$state"]}(),function(){"use strict";function e(e,t){return{request:function(t){const n=e.get("t");return n&&(t.headers["x-session-token"]=n),t},responseError:function(e){return console.log(e),401===e.status?t.get("$state").transitionTo("login"):e}}}angular.module("cwl.core").factory("authInterceptor",e),e.$inject=["$cookies","$injector"]}();
//# sourceMappingURL=app.min.js.map